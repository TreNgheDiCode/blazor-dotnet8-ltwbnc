@page "/product"

@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations

<SfGrid DataSource="@Products" AllowPaging="true" AllowSorting="true" AllowFiltering="true" AllowGrouping="true" @ref="Grid">
    <GridTemplates>
        <ToolbarTemplate>
            <SfToolbar>
                <ToolbarEvents Clicked="ToolbarClickHandler"></ToolbarEvents>
                <ToolbarItems>
                    <div class="d-flex flex-column">
                        <div>
                            <ToolbarItem Text="Thêm"></ToolbarItem>
                            <ToolbarItem Text="Cập nhật"></ToolbarItem>
                            <ToolbarItem Text="Xóa"></ToolbarItem>
                            <ToolbarItem Text="Sửa"></ToolbarItem>
                            <ToolbarItem Text="Hủy"></ToolbarItem>
                        </div>
                        <div>
                            <ToolbarItem Type="@ItemType.Button" PrefixIcon="e-chevron-up icon" Id="CollapseAll" Text="Thu gọn"></ToolbarItem>
                            <ToolbarItem Type="@ItemType.Button" PrefixIcon="e-chevron-down icon" Id="ExpandAll" Text="Mở rộng"></ToolbarItem>
                        </div>
                    </div>
                </ToolbarItems>
            </SfToolbar>
        </ToolbarTemplate>
    </GridTemplates>
    <GridGroupSettings Columns=@GroupOption>
        <CaptionTemplate>
            @{
                var data = (context as CaptionTemplateContext);
                <span>@data.HeaderText - @data.Key (@data.Count dòng)</span>
            }
        </CaptionTemplate>
    </GridGroupSettings>
    <GridEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true"></GridEditSettings>
    <GridPageSettings PageSize="5">
    </GridPageSettings>
    <GridColumns>
        <GridColumn Field=@nameof(ProductItem.Id) HeaderText="Mã sản phẩm"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.CoverUrl) HeaderText="Ảnh"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.Name) HeaderText="Tên sản phẩm"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.CategoryName) HeaderText="Loại sản phẩm"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.Price) HeaderText="Giá gốc"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.Discount) HeaderText="Giảm giá"></GridColumn>
        <GridColumn Field=@nameof(ProductItem.IsFlashSale) HeaderText="Flash Sale"></GridColumn>
    </GridColumns>
</SfGrid>

@code {
    // STT, Ảnh, Tên sản phẩm, Loại sản phẩm, Giá gốc, Giảm giá, Flash Sale, Thao tác
    public List<ProductItem> Products { get; set; } = new();
    private SfGrid<ProductItem> Grid;
    private List<string> ToolbarItems = new List<string>() { "Thêm", "Cập nhật", "Xóa", "Sửa", "Hủy" };
    private string[] GroupOption = (new string[] { "Id" });

    protected override async Task OnInitializedAsync()
    {
        try
        {
            ServiceModel<ProductList> result = await productService.GetProducts();

            if (result.Success == true && result.Data is not null)
            {
                Products = result.Data.Products;
            }
        }
        catch (Exception ex)
        {
            await DisplayDialog("Kiểm tra lại kết nối máy chủ", "Lỗi lấy danh sách sản phẩm");
        }
    }

    public async Task ToolbarClickHandler(Syncfusion.Blazor.Navigations.ClickEventArgs args)
    {
        if (args.Item.Text == "Thu gọn")
        {
            await this.Grid.CollapseAllGroupAsync();
        }
        if (args.Item.Text == "Mở rộng")
        {
            await this.Grid.ExpandAllGroupAsync();
            await this.Grid.CloseEditAsync();
        }
    }

    private async Task DisplayDialog(string content, string title)
    {
        await DialogService.AlertAsync(content, title);
    }
}
